

.. _sphx_glr_auto_examples_03_second_level_models_plot_second_level_association_test.py:


Example of generic design in second-level models
================================================

This example shows the results obtained in a group analysis using a more
complex contrast than a one- or two-sample t test.
We use the [left button press (auditory cue)] task from the Localizer
dataset and seek association between the contrast values and a variate
that measures the speed of pseudo-word reading. No confounding variate
is included in the model.





.. code-block:: python

    # Author: Virgile Fritsch, Bertrand Thirion, 2014 -- 2018








Load Localizer contrast



.. code-block:: python

    from nilearn import datasets
    n_samples = 94
    localizer_dataset = datasets.fetch_localizer_contrasts(
        ['left button press (auditory cue)'], n_subjects=n_samples)







print basic information on the dataset



.. code-block:: python

    print('First contrast nifti image (3D) is located at: %s' %
          localizer_dataset.cmaps[0])





.. rst-class:: sphx-glr-script-out

 Out::

    First contrast nifti image (3D) is located at: /home/kshitij/nilearn_data/brainomics_localizer/brainomics_data/S01/c_map_left_auditory_click.nii.gz


Load the behavioral variable



.. code-block:: python

    tested_var = localizer_dataset.ext_vars['pseudo']
    print(tested_var)





.. rst-class:: sphx-glr-script-out

 Out::

    ['15.0' '16.0' '14.0' '19.0' '16.0' '18.0' '22.0' '19.0' '17.0' '15.0'
     '10.0' '21.0' '17.0' '21.0' 'None' '14.0' '22.0' '17.0' '23.0' '15.0'
     '15.0' '18.0' '17.0' '18.0' '20.0' '27.0' '18.0' '16.0' '18.0' '17.0'
     '19.0' '22.0' '15.0' '16.0' '21.0' '20.0' '12.0' 'None' '19.0' '19.0'
     '16.0' '22.0' '23.0' '14.0' '24.0' '22.0' '20.0' '25.0' '23.0' '15.0'
     '12.0' '16.0' '20.0' '18.0' '14.0' '14.0' '18.0' '20.0' '19.0' '14.0'
     '27.0' 'None' '13.0' '17.0' '19.0' '19.0' '14.0' '17.0' '15.0' '15.0'
     '14.0' '20.0' '16.0' '15.0' '15.0' '15.0' '19.0' '17.0' '14.0' '15.0'
     'None' '20.0' '15.0' '17.0' '18.0' '17.5' 'None' '15.0' '23.0' '12.0'
     '16.0' '13.0' '25.0' '21.0']


Quality check / Remove subjects with bad tested variate



.. code-block:: python

    import numpy as np
    mask_quality_check = np.where(tested_var != b'None')[0]
    n_samples = mask_quality_check.size
    contrast_map_filenames = [localizer_dataset.cmaps[i]
                              for i in mask_quality_check]
    tested_var = tested_var[mask_quality_check].astype(float).reshape((-1, 1))
    print("Actual number of subjects after quality check: %d" % n_samples)





.. rst-class:: sphx-glr-script-out

 Out::

    Actual number of subjects after quality check: 89


Estimate second level model
---------------------------
We define the input maps and the design matrix for the second level model
and fit it.



.. code-block:: python

    import pandas as pd
    design_matrix = pd.DataFrame(
        np.hstack((tested_var, np.ones_like(tested_var))),
        columns=['fluency', 'intercept'])







Fit of the second-level model



.. code-block:: python

    from nistats.second_level_model import SecondLevelModel
    model = SecondLevelModel(smoothing_fwhm=5.0)
    model.fit(contrast_map_filenames, design_matrix=design_matrix)







To estimate the contrast is very simple. We can just provide the column
name of the design matrix.



.. code-block:: python

    z_map = model.compute_contrast('fluency', output_type='z_score')







We compute the fdr-corrected p = 0.05 threshold for these data



.. code-block:: python

    from nistats.thresholding import map_threshold
    _, threshold = map_threshold(z_map, level=.05, height_control='fdr')







Let us plot the second level contrast at the computed thresholds 



.. code-block:: python

    from nilearn import plotting
    plotting.plot_stat_map(
        z_map, threshold=threshold, colorbar=True,
        title='Group-level association between motor activity \n'
        'and reading fluency (fdr<0.05')

    plotting.show()



.. image:: /auto_examples/03_second_level_models/images/sphx_glr_plot_second_level_association_test_001.png
    :align: center




**Total running time of the script:** ( 0 minutes  7.058 seconds)



.. container:: sphx-glr-footer


  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_second_level_association_test.py <plot_second_level_association_test.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_second_level_association_test.ipynb <plot_second_level_association_test.ipynb>`

.. rst-class:: sphx-glr-signature

    `Generated by Sphinx-Gallery <https://sphinx-gallery.readthedocs.io>`_
