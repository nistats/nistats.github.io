
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Nistats: Functional MRI in Python &#8212; functional MRI for NeuroImaging</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.0.1a',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/copybutton.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="3.3.1. Simple example of GLM fitting in fMRI" href="../02_first_level_models/plot_fiac_analysis.html" />
    <link rel="prev" title="3.2.2. First level analysis of a complete BIDS dataset from openneuro" href="plot_bids_features.html" />
<meta content="True" name="HandheldFriendly">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="keywords" content="nistats, neuroimaging, python, neuroscience, statistics">
<script type="text/javascript">
$(function () {
    // Lock the table of content to a fixed position once we scroll enough
    var top = 105 + $('.sphinxsidebarwrapper').offset().top - parseFloat($('.sphinxsidebarwrapper').css('margin-top').replace(/auto/, 0)),
        sections = {},
        i        = 0,
	url	 = document.URL.replace(/#.*$/, ""),
	current_section = 0;

    // Grab positions of our sections
    $('.headerlink').each(function(){
        sections[this.href.replace(url, '')] = $(this).offset().top - 50;
    });

    $(window).scroll(function(event) {
	var pos   = $(window).scrollTop();
	// Lock the table of content to a fixed position once we scroll enough
	if(pos > top){
	    //begin to scroll
	    $('.sphinxsidebarwrapper').css("position", "fixed");
	    $('.sphinxsidebarwrapper').css("top", -105);
	}
	else{
	    //lock it back into place
	    $('.sphinxsidebarwrapper').css("position", "relative");
	    $('.sphinxsidebarwrapper').css("top",0);
	}

	// Highlight the current section
	$('a.internal').removeClass('active');
        for(i in sections){
            if(sections[i] > pos){
		break;
            };
	    if($('a.internal[href$="' + i + '"]').is(':visible')){
		current_section = i;
	    };
        }
	$('a.internal[href$="' + current_section + '"]').addClass('active');
    });

});
</script>


<script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-41920728-1']);
        _gaq.push(['_trackPageview']);

        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

  </head>
  <body>
<div id="logo-banner">
  <div class="logo">
    <a href="../../index.html">
      <img src="../../_static/nistats-logo.png" alt="Nistats logo"  border="0" />
    </a>
  </div>
  <!-- A tag cloud to make it easy for people to find what they are
                         looking for -->
 <div class="tags">
  <ul>
    <li>
      <big><a href="../04_low_level_functions/plot_hrf.html">HRF</a></big>
    </li>
    <li>
      <small><a href="../04_low_level_functions/plot_design_matrix.html">Design Matrix</a></small>
    </li>
    <li>
      <small><a href="../02_first_level_models/plot_localizer_analysis.html">First Level</a></small>
    </li>
    <li>
      <big><a href="../03_second_level_models/plot_second_level_button_press.html">Second Level</a></big>
    </li>
    <li>
      <big><a href="plot_bids_analysis.html">BIDS datasets</a></big>
    </li>
  </ul>
 </div>

  <div class="banner">
    <h1>Nistats:</h1>
    <h2>Functional MRI Neuro-Imaging in Python</h2>
  </div>
  <div class="search_form">
    <div id="cse" style="width: 100%;"></div>
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script type="text/javascript">
      google.load('search', '1', {language : 'en'});
      google.setOnLoadCallback(function() {
      var customSearchControl = new google.search.CustomSearchControl('014136483057745874622:r-npolb1uki');
      customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
      var options = new google.search.DrawOptions();
      options.setAutoComplete(true);
      customSearchControl.draw('cse', options);
      }, true);
    </script>
  </div>
</div>



    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../02_first_level_models/plot_fiac_analysis.html" title="3.3.1. Simple example of GLM fitting in fMRI"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="plot_bids_features.html" title="3.2.2. First level analysis of a complete BIDS dataset from openneuro"
             accesskey="P">previous</a> |</li>
<li><a href="../../index.html">Nistats Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" accesskey="U">3. Nistats usage examples</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">


<h4> Giving credit </h4>
  <ul class="simple">
    <li><p>Please consider <a href="../../authors.html#citing">citing the
                    papers</a>.</p></li>
  </ul>

  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">3.2.3. Univariate analysis of block design, one condition versus rest, single subject</a><ul>
<li><a class="reference internal" href="#retrieving-the-data">3.2.3.1. Retrieving the data</a></li>
<li><a class="reference internal" href="#specifying-the-experimental-paradigm">3.2.3.2. Specifying the experimental paradigm</a></li>
<li><a class="reference internal" href="#performing-the-glm-analysis">3.2.3.3. Performing the GLM analysis</a></li>
<li><a class="reference internal" href="#detecting-voxels-with-significant-effects">3.2.3.4. Detecting voxels with significant effects</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="plot_bids_features.html"
                        title="previous chapter">3.2.2. First level analysis of a complete BIDS dataset from openneuro</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../02_first_level_models/plot_fiac_analysis.html"
                        title="next chapter">3.3.1. Simple example of GLM fitting in fMRI</a></p>

<div class="navbar">
</div> <!-- end navbar -->

<script type="text/javascript">$('#searchbox-ml').show(0);</script>
<script type="text/javascript">$('#searchbox-site').show(0);</script>


        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="univariate-analysis-of-block-design-one-condition-versus-rest-single-subject">
<span id="sphx-glr-auto-examples-01-tutorials-plot-spm-auditory-py"></span><h1>3.2.3. Univariate analysis of block design, one condition versus rest, single subject<a class="headerlink" href="#univariate-analysis-of-block-design-one-condition-versus-rest-single-subject" title="Permalink to this headline">¶</a></h1>
<p>Authors: Bertrand Thirion, dohmatob elvis dopgima, Christophe Pallier, 2015–2017</p>
<p>In this tutorial, we compare the fMRI signal during periods of auditory stimulation
versus periods of rest, using a General Linear Model (GLM). We will
use a univariate approach in which independent tests are performed at
each single-voxel.</p>
<p>The dataset comes from experiment conducted at the FIL by Geriant Rees
under the direction of Karl Friston. It is provided by FIL methods
group which develops the SPM software.</p>
<p>According to SPM documentation, 96 acquisitions were made (RT=7s), in
blocks of 6, giving 16 42s blocks. The condition for successive blocks
alternated between rest and auditory stimulation, starting with rest.
Auditory stimulation was bi-syllabic words presented binaurally at a
rate of 60 per minute. The functional data starts at acquisiton 4,
image fM00223_004.</p>
<p>The whole brain BOLD/EPI images were acquired on a modified 2T Siemens
MAGNETOM Vision system. Each acquisition consisted of 64 contiguous
slices (64x64x64 3mm x 3mm x 3mm voxels). Acquisition took 6.05s, with
the scan to scan repeat time (RT) set arbitrarily to 7s.</p>
<p>This analyse described here is performed in the native space, on the
original EPI scans without any spatial or temporal preprocessing.
(More sensitive results would likely be obtained on the corrected,
spatially normalized and smoothed images).</p>
<p>To run this example, you must launch IPython via <code class="docutils literal"><span class="pre">ipython</span>
<span class="pre">--matplotlib</span></code> in a terminal, or use the Jupyter notebook.</p>
<div class="contents local topic" id="contents">
<p class="topic-title first"><strong>Contents</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#retrieving-the-data" id="id1">Retrieving the data</a></li>
<li><a class="reference internal" href="#specifying-the-experimental-paradigm" id="id2">Specifying the experimental paradigm</a></li>
<li><a class="reference internal" href="#performing-the-glm-analysis" id="id3">Performing the GLM analysis</a></li>
<li><a class="reference internal" href="#detecting-voxels-with-significant-effects" id="id4">Detecting voxels with significant effects</a></li>
</ul>
</div>
<div class="section" id="retrieving-the-data">
<h2><a class="toc-backref" href="#id1">3.2.3.1. Retrieving the data</a><a class="headerlink" href="#retrieving-the-data" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this tutorial, we load the data using a data downloading
function.To input your own data, you will need to pass
a list of paths to your own files.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nistats.datasets</span> <span class="kn">import</span> <span class="n">fetch_spm_auditory</span>
<span class="n">subject_data</span> <span class="o">=</span> <span class="n">fetch_spm_auditory</span><span class="p">()</span>
</pre></div>
</div>
<p>We can list the filenames of the functional images</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_004.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_005.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_006.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_007.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_008.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_009.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_010.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_011.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_012.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_013.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_014.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_015.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_016.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_017.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_018.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_019.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_020.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_021.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_022.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_023.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_024.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_025.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_026.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_027.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_028.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_029.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_030.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_031.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_032.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_033.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_034.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_035.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_036.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_037.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_038.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_039.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_040.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_041.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_042.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_043.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_044.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_045.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_046.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_047.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_048.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_049.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_050.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_051.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_052.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_053.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_054.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_055.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_056.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_057.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_058.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_059.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_060.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_061.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_062.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_063.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_064.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_065.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_066.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_067.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_068.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_069.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_070.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_071.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_072.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_073.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_074.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_075.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_076.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_077.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_078.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_079.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_080.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_081.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_082.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_083.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_084.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_085.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_086.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_087.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_088.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_089.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_090.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_091.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_092.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_093.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_094.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_095.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_096.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_097.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_098.img&#39;</span><span class="p">,</span> <span class="s1">&#39;/home/mfpgt/nilearn_data/spm_auditory/sub001/fM00223/fM00223_099.img&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Display the first functional image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.plotting</span> <span class="kn">import</span> <a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">,</span> <a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_anat.html#nilearn.plotting.plot_anat" title="View documentation for nilearn.plotting.plot_anat"><span class="n">plot_anat</span></a><span class="p">,</span> <a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_img.html#nilearn.plotting.plot_img" title="View documentation for nilearn.plotting.plot_img"><span class="n">plot_img</span></a>
<a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_img.html#nilearn.plotting.plot_img" title="View documentation for nilearn.plotting.plot_img"><span class="n">plot_img</span></a><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_001.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_001.png" />
<p>Display the subject’s anatomical image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_anat.html#nilearn.plotting.plot_anat" title="View documentation for nilearn.plotting.plot_anat"><span class="n">plot_anat</span></a><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">anat</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_002.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_002.png" />
<p>Next, we concatenate all the 3D EPI image into a single 4D image:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.image</span> <span class="kn">import</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.concat_imgs.html#nilearn.image.concat_imgs" title="View documentation for nilearn.image.concat_imgs"><span class="n">concat_imgs</span></a>
<span class="n">fmri_img</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.concat_imgs.html#nilearn.image.concat_imgs" title="View documentation for nilearn.image.concat_imgs"><span class="n">concat_imgs</span></a><span class="p">(</span><span class="n">subject_data</span><span class="o">.</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
<p>And we average all the EPI images in order to create a background
image that will be used to display the activations:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn</span> <span class="kn">import</span> <span class="n">image</span>
<span class="n">mean_img</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.image.mean_img.html#nilearn.image.mean_img" title="View documentation for nilearn.image.mean_img"><span class="n">image</span><span class="o">.</span><span class="n">mean_img</span></a><span class="p">(</span><span class="n">fmri_img</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="specifying-the-experimental-paradigm">
<h2><a class="toc-backref" href="#id2">3.2.3.2. Specifying the experimental paradigm</a><a class="headerlink" href="#specifying-the-experimental-paradigm" title="Permalink to this headline">¶</a></h2>
<p>We must provide a description of the experiment, that is, define the
timing of the auditory stimulation and rest periods. According to
the documentation of the dataset, there were 16 42s blocks — in
which 6 scans were acquired — alternating between rest and
auditory stimulation, starting with rest. We use standard python
functions to create a pandas.DataFrame object that specifies the
timings:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">tr</span> <span class="o">=</span> <span class="mf">7.</span>
<span class="n">slice_time_ref</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">n_scans</span> <span class="o">=</span> <span class="mi">96</span>
<span class="n">epoch_duration</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">tr</span>  <span class="c1"># duration in seconds</span>
<span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">,</span> <span class="s1">&#39;active&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">8</span>
<span class="n">n_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">conditions</span><span class="p">)</span>
<span class="n">duration</span> <span class="o">=</span> <span class="n">epoch_duration</span> <span class="o">*</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.ones.html#numpy.ones" title="View documentation for numpy.ones"><span class="n">np</span><span class="o">.</span><span class="n">ones</span></a><span class="p">(</span><span class="n">n_blocks</span><span class="p">)</span>
<span class="n">onset</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.linspace.html#numpy.linspace" title="View documentation for numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">n_blocks</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">epoch_duration</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">events</span> <span class="o">=</span> <a href="http://pandas.pydata.org/pandas-docs/stable/generated/pandas.DataFrame.corrwith.html#pandas.DataFrame" title="View documentation for pandas.DataFrame"><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span></a><span class="p">({</span><span class="s1">&#39;onset&#39;</span><span class="p">:</span> <span class="n">onset</span><span class="p">,</span> <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span> <span class="s1">&#39;trial_type&#39;</span><span class="p">:</span> <span class="n">conditions</span><span class="p">})</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">events</span></code> object contains the information for the design:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="k">print</span><span class="p">(</span><span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-default"><div class="highlight"><pre><span></span><span class="n">duration</span>  <span class="n">onset</span> <span class="n">trial_type</span>
<span class="mi">0</span>       <span class="mf">42.0</span>    <span class="mf">0.0</span>       <span class="n">rest</span>
<span class="mi">1</span>       <span class="mf">42.0</span>   <span class="mf">42.0</span>     <span class="n">active</span>
<span class="mi">2</span>       <span class="mf">42.0</span>   <span class="mf">84.0</span>       <span class="n">rest</span>
<span class="mi">3</span>       <span class="mf">42.0</span>  <span class="mf">126.0</span>     <span class="n">active</span>
<span class="mi">4</span>       <span class="mf">42.0</span>  <span class="mf">168.0</span>       <span class="n">rest</span>
<span class="mi">5</span>       <span class="mf">42.0</span>  <span class="mf">210.0</span>     <span class="n">active</span>
<span class="mi">6</span>       <span class="mf">42.0</span>  <span class="mf">252.0</span>       <span class="n">rest</span>
<span class="mi">7</span>       <span class="mf">42.0</span>  <span class="mf">294.0</span>     <span class="n">active</span>
<span class="mi">8</span>       <span class="mf">42.0</span>  <span class="mf">336.0</span>       <span class="n">rest</span>
<span class="mi">9</span>       <span class="mf">42.0</span>  <span class="mf">378.0</span>     <span class="n">active</span>
<span class="mi">10</span>      <span class="mf">42.0</span>  <span class="mf">420.0</span>       <span class="n">rest</span>
<span class="mi">11</span>      <span class="mf">42.0</span>  <span class="mf">462.0</span>     <span class="n">active</span>
<span class="mi">12</span>      <span class="mf">42.0</span>  <span class="mf">504.0</span>       <span class="n">rest</span>
<span class="mi">13</span>      <span class="mf">42.0</span>  <span class="mf">546.0</span>     <span class="n">active</span>
<span class="mi">14</span>      <span class="mf">42.0</span>  <span class="mf">588.0</span>       <span class="n">rest</span>
<span class="mi">15</span>      <span class="mf">42.0</span>  <span class="mf">630.0</span>     <span class="n">active</span>
</pre></div>
</div>
</div>
<div class="section" id="performing-the-glm-analysis">
<h2><a class="toc-backref" href="#id3">3.2.3.3. Performing the GLM analysis</a><a class="headerlink" href="#performing-the-glm-analysis" title="Permalink to this headline">¶</a></h2>
<p>We need to construct a <em>design matrix</em> using the timing information
provided by the <code class="docutils literal"><span class="pre">events</span></code> object. The design matrix contains
regressors of interest as well as regressors of non-interest
modeling temporal drifts:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">frame_times</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.linspace.html#numpy.linspace" title="View documentation for numpy.linspace"><span class="n">np</span><span class="o">.</span><span class="n">linspace</span></a><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">n_scans</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tr</span><span class="p">,</span> <span class="n">n_scans</span><span class="p">)</span>
<span class="n">drift_model</span> <span class="o">=</span> <span class="s1">&#39;Cosine&#39;</span>
<span class="n">period_cut</span> <span class="o">=</span> <span class="mf">4.</span> <span class="o">*</span> <span class="n">epoch_duration</span>
<span class="n">hrf_model</span> <span class="o">=</span> <span class="s1">&#39;glover + derivative&#39;</span>
</pre></div>
</div>
<p>It is now time to create a <code class="docutils literal"><span class="pre">FirstLevelModel</span></code> object
and fit it to the 4D dataset:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nistats.first_level_model</span> <span class="kn">import</span> <span class="n">FirstLevelModel</span>

<span class="n">fmri_glm</span> <span class="o">=</span> <span class="n">FirstLevelModel</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">slice_time_ref</span><span class="p">,</span> <span class="n">noise_model</span><span class="o">=</span><span class="s1">&#39;ar1&#39;</span><span class="p">,</span>
                           <span class="n">standardize</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">hrf_model</span><span class="o">=</span><span class="n">hrf_model</span><span class="p">,</span>
                           <span class="n">drift_model</span><span class="o">=</span><span class="n">drift_model</span><span class="p">,</span> <span class="n">period_cut</span><span class="o">=</span><span class="n">period_cut</span><span class="p">)</span>
<span class="n">fmri_glm</span> <span class="o">=</span> <span class="n">fmri_glm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">fmri_img</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p>One can inspect the design matrix (rows represent time, and
columns contain the predictors):</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nistats.reporting</span> <span class="kn">import</span> <span class="n">plot_design_matrix</span>
<span class="n">design_matrix</span> <span class="o">=</span> <span class="n">fmri_glm</span><span class="o">.</span><span class="n">design_matrices_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">plot_design_matrix</span><span class="p">(</span><span class="n">design_matrix</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_003.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_003.png" />
<p>The first column contains the expected reponse profile of regions which are
sensitive to the auditory stimulation.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="View documentation for matplotlib.pyplot.plot"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">design_matrix</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">])</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel" title="View documentation for matplotlib.pyplot.xlabel"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span></a><span class="p">(</span><span class="s1">&#39;scan&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.title.html#matplotlib.pyplot.title" title="View documentation for matplotlib.pyplot.title"><span class="n">plt</span><span class="o">.</span><span class="n">title</span></a><span class="p">(</span><span class="s1">&#39;Expected Auditory Response&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_004.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_004.png" />
</div>
<div class="section" id="detecting-voxels-with-significant-effects">
<h2><a class="toc-backref" href="#id4">3.2.3.4. Detecting voxels with significant effects</a><a class="headerlink" href="#detecting-voxels-with-significant-effects" title="Permalink to this headline">¶</a></h2>
<p>To access the estimated coefficients (Betas of the GLM model), we
created constrasts with a single ‘1’ in each of the columns:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">contrast_matrix</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.eye.html#numpy.eye" title="View documentation for numpy.eye"><span class="n">np</span><span class="o">.</span><span class="n">eye</span></a><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">contrasts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">column</span><span class="p">,</span> <span class="n">contrast_matrix</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                  <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">design_matrix</span><span class="o">.</span><span class="n">columns</span><span class="p">)])</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">contrasts::</span>

<span class="sd">  {</span>
<span class="sd">  &#39;active&#39;:            array([ 1.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;active_derivative&#39;: array([ 0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;constant&#39;:          array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  1.]),</span>
<span class="sd">  &#39;drift_1&#39;:           array([ 0.,  0.,  0.,  0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_2&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_3&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  0.,  1.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_4&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  1.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_5&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  1.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_6&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  1.,  0.,  0.]),</span>
<span class="sd">  &#39;drift_7&#39;:           array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  1.,  0.]),</span>
<span class="sd">  &#39;rest&#39;:              array([ 0.,  0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.]),</span>
<span class="sd">  &#39;rest_derivative&#39;:   array([ 0.,  0.,  0.,  1.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.])}</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>We can then compare the two conditions ‘active’ and ‘rest’ by
generating the relevant contrast:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">active_minus_rest</span> <span class="o">=</span>  <span class="n">contrasts</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">contrasts</span><span class="p">[</span><span class="s1">&#39;rest&#39;</span><span class="p">]</span>

<span class="n">eff_map</span> <span class="o">=</span> <span class="n">fmri_glm</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">active_minus_rest</span><span class="p">,</span>
                                    <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;effect_size&#39;</span><span class="p">)</span>

<span class="n">z_map</span> <span class="o">=</span> <span class="n">fmri_glm</span><span class="o">.</span><span class="n">compute_contrast</span><span class="p">(</span><span class="n">active_minus_rest</span><span class="p">,</span>
                                  <span class="n">output_type</span><span class="o">=</span><span class="s1">&#39;z_score&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Plot thresholded z scores map</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><a href="http://nilearn.github.io/modules/generated/nilearn.plotting.plot_stat_map.html#nilearn.plotting.plot_stat_map" title="View documentation for nilearn.plotting.plot_stat_map"><span class="n">plot_stat_map</span></a><span class="p">(</span><span class="n">z_map</span><span class="p">,</span> <span class="n">bg_img</span><span class="o">=</span><span class="n">mean_img</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span>
              <span class="n">display_mode</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">cut_coords</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">black_bg</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Active minus Rest (Z&gt;3)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_005.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_005.png" />
<p>We can use <code class="docutils literal"><span class="pre">nibabel.save</span></code> to save the effect and zscore maps to the disk</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">outdir</span> <span class="o">=</span> <span class="s1">&#39;results&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">outdir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">outdir</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">nibabel</span>
<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">join</span>
<span class="n">nibabel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">z_map</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;active_vs_rest_z_map.nii&#39;</span><span class="p">))</span>
<span class="n">nibabel</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">eff_map</span><span class="p">,</span> <span class="n">join</span><span class="p">(</span><span class="s1">&#39;results&#39;</span><span class="p">,</span> <span class="s1">&#39;active_vs_rest_eff_map.nii&#39;</span><span class="p">))</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Extract the signal from a voxels</dt>
<dd></dd>
</dl>
<p>We search for the voxel with the larger z-score and plot the signal
(warning: double dipping!)</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="c1"># Find the coordinates of the peak</span>

<span class="kn">from</span> <span class="nn">nibabel.affines</span> <span class="kn">import</span> <a href="http://nipy.org/nibabel/reference/nibabel.affines.html#nibabel.affines.apply_affine" title="View documentation for nibabel.affines.apply_affine"><span class="n">apply_affine</span></a>
<span class="n">values</span> <span class="o">=</span> <span class="n">z_map</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>
<span class="n">coord_peaks</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.dstack.html#numpy.dstack" title="View documentation for numpy.dstack"><span class="n">np</span><span class="o">.</span><span class="n">dstack</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.unravel_index.html#numpy.unravel_index" title="View documentation for numpy.unravel_index"><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.6.0/reference/generated/numpy.argsort.html#numpy.argsort" title="View documentation for numpy.argsort"><span class="n">np</span><span class="o">.</span><span class="n">argsort</span></a><span class="p">(</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()),</span>
                                         <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">coord_mm</span> <span class="o">=</span> <a href="http://nipy.org/nibabel/reference/nibabel.affines.html#nibabel.affines.apply_affine" title="View documentation for nibabel.affines.apply_affine"><span class="n">apply_affine</span></a><span class="p">(</span><span class="n">z_map</span><span class="o">.</span><span class="n">affine</span><span class="p">,</span> <span class="n">coord_peaks</span><span class="p">)</span>
</pre></div>
</div>
<p>We create a masker for the voxel (allowing us to detrend the signal)
and extract the time course</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nilearn.input_data</span> <span class="kn">import</span> <a href="http://nilearn.github.io/modules/generated/nilearn.input_data.NiftiSpheresMasker.html#nilearn.input_data.NiftiSpheresMasker" title="View documentation for nilearn.input_data.NiftiSpheresMasker"><span class="n">NiftiSpheresMasker</span></a>
<span class="n">mask</span> <span class="o">=</span> <a href="http://nilearn.github.io/modules/generated/nilearn.input_data.NiftiSpheresMasker.html#nilearn.input_data.NiftiSpheresMasker" title="View documentation for nilearn.input_data.NiftiSpheresMasker"><span class="n">NiftiSpheresMasker</span></a><span class="p">([</span><span class="n">coord_mm</span><span class="p">],</span> <span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                          <span class="n">detrend</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">standardize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">high_pass</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">low_pass</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">t_r</span><span class="o">=</span><span class="mf">7.</span><span class="p">)</span>
<span class="n">sig</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">fmri_img</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s plot the signal and the theoretical response</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="View documentation for matplotlib.pyplot.plot"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">frame_times</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;voxel </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1"> </span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">coord_mm</span><span class="p">))</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.plot.html#matplotlib.pyplot.plot" title="View documentation for matplotlib.pyplot.plot"><span class="n">plt</span><span class="o">.</span><span class="n">plot</span></a><span class="p">(</span><span class="n">design_matrix</span><span class="p">[</span><span class="s1">&#39;active&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.xlabel.html#matplotlib.pyplot.xlabel" title="View documentation for matplotlib.pyplot.xlabel"><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span></a><span class="p">(</span><span class="s1">&#39;scan&#39;</span><span class="p">)</span>
<a href="http://matplotlib.org/api/legend_api.html#matplotlib.legend" title="View documentation for matplotlib.pyplot.legend"><span class="n">plt</span><span class="o">.</span><span class="n">legend</span></a><span class="p">()</span>
<a href="http://matplotlib.org/api/_as_gen/matplotlib.pyplot.show.html#matplotlib.pyplot.show" title="View documentation for matplotlib.pyplot.show"><span class="n">plt</span><span class="o">.</span><span class="n">show</span></a><span class="p">()</span>
</pre></div>
</div>
<img alt="../../_images/sphx_glr_plot_spm_auditory_006.png" class="align-center" src="../../_images/sphx_glr_plot_spm_auditory_006.png" />
<p><strong>Total running time of the script:</strong> ( 0 minutes  7.145 seconds)</p>
<div class="sphx-glr-footer docutils container">
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_spm_auditory.py" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_spm_auditory.py</span></code></a></div>
<div class="sphx-glr-download docutils container">
<a class="reference download internal" href="../../_downloads/plot_spm_auditory.ipynb" download=""><code class="xref download docutils literal"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_spm_auditory.ipynb</span></code></a></div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.readthedocs.io">Generated by Sphinx-Gallery</a></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a></li>
        <li class="right" >
          <a href="../02_first_level_models/plot_fiac_analysis.html" title="3.3.1. Simple example of GLM fitting in fMRI"
             >next</a> |</li>
        <li class="right" >
          <a href="plot_bids_features.html" title="3.2.2. First level analysis of a complete BIDS dataset from openneuro"
             >previous</a> |</li>
<li><a href="../../index.html">Nistats Home</a> |&nbsp;</li>
<li><a href="../../user_guide.html">User Guide</a> |&nbsp;</li>
<li><a href="../index.html">Examples</a> |&nbsp;</li>
<li><a href="../../modules/reference.html">Reference</a> |&nbsp;</li>
<li id="navbar-about"><a href="../../authors.html">About</a>|&nbsp;</li>
<li id="navbar-ecosystem"><a href="http://www.nipy.org/">Nipy ecosystem</a></li>

          <li class="nav-item nav-item-1"><a href="../../user_guide.html" >User guide: table of contents</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../index.html" >3. Nistats usage examples</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
            &copy; The nistats developers 2010-2016.
          Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.6.3.
        <span style="padding-left: 5ex;">
          <a href="../../_sources/auto_examples/01_tutorials/plot_spm_auditory.rst.txt"
        	 rel="nofollow">Show this page source</a>
        </span>
    </div>
  </body>
</html>